(**************************************************************************)
(*       ___                                                              *)
(*      ||M||                                                             *)
(*      ||A||       A project by Andrea Asperti                           *)
(*      ||T||                                                             *)
(*      ||I||       Developers:                                           *)
(*      ||T||         The HELM team.                                      *)
(*      ||A||         http://helm.cs.unibo.it                             *)
(*      \   /                                                             *)
(*       \ /        This file is distributed under the terms of the       *)
(*        v         GNU General Public License Version 2                  *)
(*                                                                        *)
(**************************************************************************)

include "arithmetics/nat.ma".

definition max : nat â†’ nat â†’ nat â‰ Î»a,b. match a with [ O â‡’ b | S n â‡’ match b with [ O â‡’ a | S m â‡’ max n m]].
definition min : nat â†’ nat â†’ nat â‰ Î»a,b:nat. match a with [ O â‡’ a | S n â‡’ match b with [ O â‡’ b | S m â‡’ min n m]].

(*
inductive term : Type[0] â‰
| BByte: Byte â†’ term
| CrumbledValue: Value â†’ term
| EEnvironment: Environment â†’ term
| CCrumble: Crumble â†’ term

with Byte : Type[0] â‰
 | CValue: Value â†’ Byte
 | AppValue: Value â†’ Value â†’ Byte

with Value : Type[0] â‰
 | Variable: nat â†’ Value
 | Abstraction: Value â†’ Crumble â†’ Value
 
with Environment : Type[0] â‰
 | Epsilon: Environment
 | Abstraction: Environment â†’ Value â†’ Byte â†’ Environment
 
with Crumble : Type[0] â‰
 | CCCrumble: Byte â†’ Environment â†’ Crumble 
.
*)

inductive Crumble : Type[0] â‰
 | CCrumble: Byte â†’ Environment â†’ Crumble 
 
with Byte : Type[0] â‰
 | CValue: Value â†’ Byte
 | AppValue: Value â†’ Value â†’ Byte

with Value : Type[0] â‰
 | var : Variable â†’ Value
 | lambda: Variable â†’ Crumble â†’ Value
 
with Variable: Type[0] â‰
 | variable: nat â†’ Variable
 
with Environment : Type[0] â‰
 | Epsilon: Environment
 | Cons: Environment â†’ Substitution â†’ Environment
 
with Substitution: Type[0] â‰
 | subst: Value â†’ Byte â†’ Substitution
.

notation "[ term 19 v â† term 19 b ]" non associative with precedence 90 for @{ 'substitution $v $b }.
interpretation "Substitution" 'substitution v b =(subst v b).

(*notation "âŒ© b break, e âŒª" non associative with precedence 90 for @{ 'ccrumble $b $e }.
*)
interpretation "Crumble creation" 'pair b e =(CCrumble b e).

notation "Î½ n" non associative with precedence 90 for @{ 'variable $n }.
interpretation "Variable number" 'variable n =(variable n).

notation "ğ›Œ x . y" right associative with precedence 40 for @{ 'lambda $x $y}.
interpretation "Abstraction" 'lambda x y = (lambda x y ).

lemma test_lambda0: âˆ€x: Variable. âˆ€y:Crumble. (ğ›Œx.y) = (lambda x y).
#x #y normalize // qed.

let rec push e a â‰  
 match e with
 [ Epsilon â‡’ Cons Epsilon a
 | Cons e1 a1 â‡’ Cons (push e1 a) (a1)
 ].
 
lemma push_test0: Cons (Cons Epsilon [var Î½0 â† CValue (var Î½0)]) [var Î½1 â† CValue (var Î½3)] = push ((Cons Epsilon [var Î½1 â† CValue (var Î½3)])) ([var Î½0 â† CValue (var Î½0)]).
normalize //. qed. 

let rec concat a b â‰ 
 match a with
 [ Epsilon â‡’ b
 | Cons e a' â‡’ match b with 
                      [ Epsilon â‡’ Cons e a'
                      | Cons e' b' â‡’ Cons (concat e (push e' a')) b'
                      ]
 ].

lemma concat_test0: concat (Cons (Cons Epsilon [var Î½0 â† CValue (var Î½0)]) [var Î½1 â† CValue (var Î½3)]) (Cons (Cons Epsilon [var Î½2 â† CValue (var Î½3)]) [var Î½1 â† CValue (var Î½2)])=
(Cons (Cons (Cons (Cons Epsilon [var Î½0 â† CValue (var Î½0)]) [var Î½1 â† CValue (var Î½3)]) [var Î½2 â† CValue (var Î½3)]) [var Î½1 â† CValue (var Î½2)]).//. qed.

definition at: Crumble â†’ Environment â†’ Crumble â‰ Î»a,b.
match a with
[ CCrumble byte e  â‡’ CCrumble byte (concat e b) 
].

notation "hvbox(c @ e)" with precedence 35 for @{ 'at $c $e }.
interpretation "@ operation" 'at c e =(at c e).

definition v0: Value â‰ var Î½0.
definition b0: Byte â‰ CValue v0.
definition e0: Environment â‰ Epsilon.
definition e1: Environment â‰ Cons e0 [v0 â† b0].

definition v1: Value â‰ var Î½1.
definition e2: Environment â‰ Cons e0 [v1 â† b0].

definition c0: Crumble â‰ âŒ© b0, e1 âŒª.
lemma test1:  e2 = e2. // qed.

lemma test2: c0 = CCrumble b0 e1. // qed.

lemma test3: (âŒ© b0, e1 âŒª @ e2) = âŒ© b0, concat e1 e2 âŒª.
// qed.